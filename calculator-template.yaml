AWSTemplateFormatVersion: '2010-09-09'
Description: AWS CloudFormation for a simple calculator Lambda function and static website hosting on S3.

Resources:
  CalculatorLambdaFunction:
    Type: AWS::Lambda::Function
    Properties:
      Handler: lambda_function.lambda_handler
      Role: !GetAtt LambdaExecutionRole.Arn
      Code:
        ZipFile: |
          import json
          def lambda_handler(event, context):
              operation = event.get('operation', 'add')
              number1 = float(event.get('number1', 0))
              number2 = float(event.get('number2', 0))
              if operation == 'add':
                  result = number1 + number2
              elif operation == 'subtract':
                  result = number1 - number2
              elif operation == 'multiply':
                  result = number1 * number2
              elif operation == 'divide':
                  result = number1 / number2 if number2 != 0 else 'undefined'
              else:
                  return {'statusCode': 400, 'body': json.dumps('Invalid operation')}
              return {'statusCode': 200, 'body': json.dumps({'result': result})}
      Runtime: python3.8

  LambdaExecutionRole:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
          - Effect: Allow
            Principal:
              Service:
                - lambda.amazonaws.com
            Action:
              - 'sts:AssumeRole'
      Policies:
        - PolicyName: LambdaExecutionPolicy
          PolicyDocument:
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - 'logs:CreateLogGroup'
                  - 'logs:CreateLogStream'
                  - 'logs:PutLogEvents'
                Resource: '*'

  WebsiteBucket:
    Type: AWS::S3::Bucket
    Properties:
      AccessControl: PublicRead
      WebsiteConfiguration:
        IndexDocument: calculator-page.html
        ErrorDocument: error.html

  BucketPolicy:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket: !Ref WebsiteBucket
      PolicyDocument:
        Statement:
          - Effect: Allow
            Principal: "*"
            Action: "s3:GetObject"
            Resource: !Sub "arn:aws:s3:::${WebsiteBucket}/calculator-page.html"

Outputs:
  LambdaFunctionArn:
    Description: The ARN of the Lambda function
    Value: !GetAtt CalculatorLambdaFunction.Arn
  WebsiteURL:
    Description: URL of the S3 website
    Value: !GetAtt WebsiteBucket.WebsiteURL
